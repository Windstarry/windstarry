import{_ as l,o as n,c as o,W as a,A as s,a as p}from"./chunks/framework.1977b413.js";const e="/windstarry/assets/7bf174c3fb457543d7356c5e659046b9c1e6e2f8eb91c43dd8a432952c815952.7bf174c3.png",t="/windstarry/assets/a67fb7595f9d4fbe8887a1bf8b9bffc9310f243894defca1e3b3d99f130bcb4b.a67fb759.png",c="/windstarry/assets/0a564d4d2af312d8076dc3ef08aafdfa800bfa34af2694ef86c1b42231c2e4e6.0a564d4d.png",b=JSON.parse('{"title":"tortoise-orm入门之单表常用操作","description":"tortoise-orm入门之单表常用操作","frontmatter":{"title":"tortoise-orm入门之单表常用操作","description":"tortoise-orm入门之单表常用操作","date":"2023-5-19","recommend":1,"sticky":3,"tags":["python","项目实战","tortoise","fastapi"],"categories":["python"]},"headers":[],"relativePath":"learn/python/tortoise-orm入门之单表常用操作.md"}'),r={name:"learn/python/tortoise-orm入门之单表常用操作.md"},F=a(`<h1 id="tortoise-orm入门之单表常用操作" tabindex="-1">tortoise-orm入门之单表常用操作 <a class="header-anchor" href="#tortoise-orm入门之单表常用操作" aria-label="Permalink to &quot;tortoise-orm入门之单表常用操作&quot;">​</a></h1><h2 id="创建用户模型" tabindex="-1">创建用户模型 <a class="header-anchor" href="#创建用户模型" aria-label="Permalink to &quot;创建用户模型&quot;">​</a></h2><ul><li>在创建模型类时，把一些公共的字段抽离出来，用继承方式重复利用。</li><li>如果模型类型的字段与数据库字不一样时候，可以通过source_field指定。</li><li>Meta定义表的元数据信息，例如：表名，表描述信息等等</li></ul><div class="language-python"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">#models.py</span></span>
<span class="line"><span style="color:#C792EA;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">MixinTimeFiled</span><span style="color:#89DDFF;">:</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;"># 添加数据时间</span></span>
<span class="line"><span style="color:#A6ACCD;">    created </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> fields</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">DatetimeField</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">null</span><span style="color:#89DDFF;">=True,</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;font-style:italic;">auto_now_add</span><span style="color:#89DDFF;">=True)</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;"># 修改数据时间</span></span>
<span class="line"><span style="color:#A6ACCD;">    modified </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> fields</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">DatetimeField</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">null</span><span style="color:#89DDFF;">=True,</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;font-style:italic;">auto_now</span><span style="color:#89DDFF;">=True)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">userModel</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">MixinTimeFiled</span><span style="color:#89DDFF;">,</span><span style="color:#FFCB6B;">Model</span><span style="color:#89DDFF;">):</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#82AAFF;">id</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> fields</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">BigIntField</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">pk</span><span style="color:#89DDFF;">=True,</span><span style="color:#A6ACCD;font-style:italic;">description</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">用户ID</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;font-style:italic;">index</span><span style="color:#89DDFF;">=True,</span><span style="color:#A6ACCD;font-style:italic;">source_field</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">user_id</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    name </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> fields</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">CharField</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">max_length</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">100</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;font-style:italic;">description</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">用户名</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;font-style:italic;">source_field</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">name</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    phone </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> fields</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">CharField</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">max_length</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">11</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;font-style:italic;">description</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">电话号</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    idcard </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">fields</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">CharField</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">max_length</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">18</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;font-style:italic;">description</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">身份号</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    birthDate </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> fields</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">CharField</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">max_length</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">18</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;font-style:italic;">description</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">出生年月</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    email </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> fields</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">CharField</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">max_length</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">50</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;font-style:italic;">description</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">邮箱地址</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    address </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> fields</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">CharField</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">max_length</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">200</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;font-style:italic;">description</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">地址信息</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">  </span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Meta</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">        table </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">users</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"></span></code></pre></div><p>关于各字段的用法查看<a href="https://tortoise.github.io/fields.html#tortoise.models.Model.in_bulk" target="_blank" rel="noreferrer">官方文档</a></p><h3 id="模型设置" tabindex="-1">模型设置 <a class="header-anchor" href="#模型设置" aria-label="Permalink to &quot;模型设置&quot;">​</a></h3><div class="language-python"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> tortoise</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">models </span><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> Model</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> tortoise</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">manager </span><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> Manager</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Team</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">Model</span><span style="color:#89DDFF;">):</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#82AAFF;">id</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> fields</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">IntField</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">pk</span><span style="color:#89DDFF;">=True)</span></span>
<span class="line"><span style="color:#A6ACCD;">    name </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> fields</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">TextField</span><span style="color:#89DDFF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Meta</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">        abstract </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">False</span></span>
<span class="line"><span style="color:#A6ACCD;">        table </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">team</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">        table_description </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">        unique_together </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">()</span></span>
<span class="line"><span style="color:#A6ACCD;">        indexes </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">()</span></span>
<span class="line"><span style="color:#A6ACCD;">        ordering </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[]</span></span>
<span class="line"><span style="color:#A6ACCD;">        manager </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> Manager</span></span>
<span class="line"></span></code></pre></div><div class="tip custom-block"><p class="custom-block-title">TIP</p><ul><li>abstract:设置为 True 表明这是一个抽象类,不会生成数据表</li><li>table：设置表名，不设置默认已类名作为数据表名</li><li>table_description：设置此项可为为当前模型创建的表生成注释消息 unique_together : 指定 unique_together 为列集设置复合唯一索引，其为元组的元组</li><li>indexes:指定 indexes 为列集设置复合非唯一索引，它应该是元组的元组</li><li>ordering : 指定 ordering 为给定模型设置默认排序。.order_by(...)它应该可以迭代以与接收相同的方式格式化的字符串</li><li>manager: 指定 manager 覆盖默认管理器。它应该是实例 tortoise.manager.Manager 或子类</li></ul></div><h3 id="数据设置" tabindex="-1">数据设置 <a class="header-anchor" href="#数据设置" aria-label="Permalink to &quot;数据设置&quot;">​</a></h3><div class="language-python"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#82AAFF;">Field</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">source_field</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">None</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;font-style:italic;">generated</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">False</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;font-style:italic;">pk</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">False</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;font-style:italic;">null</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">False</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;font-style:italic;">default</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">None</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;font-style:italic;">unique</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">False</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;font-style:italic;">index</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">False</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;font-style:italic;">description</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">None</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;font-style:italic;">model</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">None</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;font-style:italic;">validators</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">None</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">**</span><span style="color:#82AAFF;"> kwargs</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span></code></pre></div><div class="tip custom-block"><p class="custom-block-title">TIP</p><ul><li>source_field (Optional[str]): 如果 DB 列名称需要是特定的而不是从字段名称中生成，则提供 source_field 名称。</li><li>generated (bool): 该字段是否由数据库生成</li><li>pk (bool): 该字段是否为主键</li><li>null (bool): 主键是否可以为空</li><li>default (Optional[Any])：该字段的默认值</li><li>unique (bool) ：该字段的值是否唯一</li><li>index (bool)：设置该字段是否为索引</li><li>description (Optional[str]) ：字段描述，也将出现在Tortoise.desc&gt; ribe_model()生成的 DDL 中并作为 DB 注释出现。</li><li>validators (Optional[List[Union[Validator, Callable]]]) ：此字段的验证器</li></ul></div><h3 id="关系字段" tabindex="-1">关系字段 <a class="header-anchor" href="#关系字段" aria-label="Permalink to &quot;关系字段&quot;">​</a></h3><div class="language-python"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#82AAFF;">ForeignKeyField</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">model_name</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;font-style:italic;">related_name</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">None</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;font-style:italic;">on_delete</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">CASCADE</span><span style="color:#89DDFF;">&#39;</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;font-style:italic;">db_constraint</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">True</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">**</span><span style="color:#82AAFF;"> kwargs </span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#82AAFF;">OneToOneField</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">model_name</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;font-style:italic;">related_name</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">None</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;font-style:italic;">on_delete</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">CASCADE</span><span style="color:#89DDFF;">&#39;</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;font-style:italic;">db_constraint</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">True</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">**</span><span style="color:#82AAFF;"> kwargs </span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#82AAFF;">ManyToManyField</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">model_name</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;font-style:italic;">through</span><span style="color:#89DDFF;">=None,</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;font-style:italic;">forward_key</span><span style="color:#89DDFF;">=None,</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;font-style:italic;">backward_key</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&#39;&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;font-style:italic;">related_name</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&#39;&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;font-style:italic;">on_delete</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">CASCADE</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;font-style:italic;">db_constraint</span><span style="color:#89DDFF;">=True,</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">**</span><span style="color:#82AAFF;">kwargs</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span></code></pre></div>`,13),y=s("div",{class:"tip custom-block"},[s("p",{class:"custom-block-title"},"TIP"),s("ul",null,[s("li",{models:""},"model_name：关联模型的名称{app}."),s("li",null,"related_name：相关模型上的属性名称，用于反向解析外键"),s("li",null,[p("on_delete： "),s("ul",null,[s("li",null,"field.CASCADE：表示如果相关模型被删除，该模型应该被级联删除"),s("li",null,"field.RESTRICT：表示只要有外键指向，相关模型删除就会受到限制"),s("li",null,"field.SET_NULL：将字段重置为 NULL，以防相关模型被删除。仅当字段已设置时才能null=True设置"),s("li",null,"field.SET_DEFAULT：将字段重置为default值，以防相关模型被删除。只能设置是字段有一个default集合")])]),s("li",null,"to_field：建立外键关系的相关模型上的属性名。如果未设置，则使用pk"),s("li",null,"db_constraint： 控制是否应在数据库中为此外键创建约束。默认值为 True，将此设置为 False 可能对数据完整性非常不利"),s("li",null,"through：通过中间表进行连接"),s("li",null,"forward_key： 直通表上的正向查找键。默认值通常是安全的"),s("li",null,"backward_key： 通表上的向后查找键。默认值通常是安全的")])],-1),D=a(`<h2 id="配置数据库相关信息" tabindex="-1">配置数据库相关信息 <a class="header-anchor" href="#配置数据库相关信息" aria-label="Permalink to &quot;配置数据库相关信息&quot;">​</a></h2><div class="language-python"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">async</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">def</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">init</span><span style="color:#89DDFF;">():</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#A6ACCD;"> Tortoise</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">init</span><span style="color:#89DDFF;">(</span></span>
<span class="line"><span style="color:#82AAFF;">        </span><span style="color:#A6ACCD;font-style:italic;">db_url</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">mysql://didiplus:didiplus558@192.168.0.220:3306/tortoise</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#82AAFF;">        </span><span style="color:#A6ACCD;font-style:italic;">modules</span><span style="color:#89DDFF;">={</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">models</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">:</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">models</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">]}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">    </span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;"># Generate the schema</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#A6ACCD;"> Tortoise</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">generate_schemas</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;">  </span><span style="color:#676E95;font-style:italic;"># safe：仅在表不存在时创建表</span></span>
<span class="line"></span></code></pre></div><h2 id="增-create" tabindex="-1">增(Create) <a class="header-anchor" href="#增-create" aria-label="Permalink to &quot;增(Create)&quot;">​</a></h2><p>Tortoise ORM 模型提供了create方法，通过查看源码create方法实际上也是调用了save方法。所以，有两种方式添加数据。</p><p><img src="`+e+`" alt="图片"></p><p>可以使用Faker这个库去模拟用户数据，具体的用法请参考这篇<a href="https://juejin.cn/post/7064457994540417038" target="_blank" rel="noreferrer">文章</a></p><h3 id="_1-save-方法新增数据" tabindex="-1">1.save 方法新增数据： <a class="header-anchor" href="#_1-save-方法新增数据" aria-label="Permalink to &quot;1.save 方法新增数据：&quot;">​</a></h3><p>通过实例化用户模型类的方式，调用save方式创建数据，核心代码如下：</p><div class="language-python"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki material-theme-palenight"><code><span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">fake </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">Faker</span><span style="color:#89DDFF;">([</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">zh_CN</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">])</span></span>
<span class="line"><span style="color:#A6ACCD;">id_card </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> fake</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">ssn</span><span style="color:#89DDFF;">()</span></span>
<span class="line"><span style="color:#C792EA;">async</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">def</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">add</span><span style="color:#89DDFF;">():</span></span>
<span class="line"><span style="color:#A6ACCD;">    user </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">userModel</span><span style="color:#89DDFF;">(</span></span>
<span class="line"><span style="color:#82AAFF;">        </span><span style="color:#A6ACCD;font-style:italic;">name</span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;">fake</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">name</span><span style="color:#89DDFF;">(),</span></span>
<span class="line"><span style="color:#82AAFF;">        </span><span style="color:#A6ACCD;font-style:italic;">phone</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;"> fake</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">phone_number</span><span style="color:#89DDFF;">(),</span></span>
<span class="line"><span style="color:#82AAFF;">        </span><span style="color:#A6ACCD;font-style:italic;">idcard</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;"> fake</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">ssn</span><span style="color:#89DDFF;">(),</span></span>
<span class="line"><span style="color:#82AAFF;">        </span><span style="color:#A6ACCD;font-style:italic;">birthDate</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;"> id_card</span><span style="color:#89DDFF;">[</span><span style="color:#F78C6C;">6</span><span style="color:#89DDFF;">:</span><span style="color:#F78C6C;">14</span><span style="color:#89DDFF;">],</span></span>
<span class="line"><span style="color:#82AAFF;">        </span><span style="color:#A6ACCD;font-style:italic;">email</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;"> fake</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">email</span><span style="color:#89DDFF;">(),</span></span>
<span class="line"><span style="color:#82AAFF;">        </span><span style="color:#A6ACCD;font-style:italic;">address</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;"> fake</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">address</span><span style="color:#89DDFF;">()</span></span>
<span class="line"><span style="color:#82AAFF;">    </span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#A6ACCD;"> user</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">save</span><span style="color:#89DDFF;">()</span></span>
<span class="line"></span></code></pre></div><p>由于Tortoise ORM采用了异步编程方式，所以，需要通过run_async函数去调用add方式.核心代码如下：</p><div class="language-python"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki material-theme-palenight"><code><span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#A6ACCD;"> __name__ </span><span style="color:#89DDFF;">==</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">__main__</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#82AAFF;">run_async</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">init</span><span style="color:#89DDFF;">())</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">#连接数据库</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#82AAFF;">run_async</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">add</span><span style="color:#89DDFF;">())</span></span>
<span class="line"></span></code></pre></div><h3 id="_2-create方法新增数据" tabindex="-1">2.create方法新增数据 <a class="header-anchor" href="#_2-create方法新增数据" aria-label="Permalink to &quot;2.create方法新增数据&quot;">​</a></h3><p>直接通过用户模型类赋值方式，然后调用create方法。核心代码如下：</p><div class="language-python"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">async</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">def</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">add2</span><span style="color:#89DDFF;">():</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">userModel</span><span style="color:#89DDFF;">().</span><span style="color:#82AAFF;">create</span><span style="color:#89DDFF;">(</span></span>
<span class="line"><span style="color:#82AAFF;">        </span><span style="color:#A6ACCD;font-style:italic;">name</span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;">fake</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">name</span><span style="color:#89DDFF;">(),</span></span>
<span class="line"><span style="color:#82AAFF;">        </span><span style="color:#A6ACCD;font-style:italic;">phone</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;"> fake</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">phone_number</span><span style="color:#89DDFF;">(),</span></span>
<span class="line"><span style="color:#82AAFF;">        </span><span style="color:#A6ACCD;font-style:italic;">idcard</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;"> fake</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">ssn</span><span style="color:#89DDFF;">(),</span></span>
<span class="line"><span style="color:#82AAFF;">        </span><span style="color:#A6ACCD;font-style:italic;">birthDate</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;"> id_card</span><span style="color:#89DDFF;">[</span><span style="color:#F78C6C;">6</span><span style="color:#89DDFF;">:</span><span style="color:#F78C6C;">14</span><span style="color:#89DDFF;">],</span></span>
<span class="line"><span style="color:#82AAFF;">        </span><span style="color:#A6ACCD;font-style:italic;">email</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;"> fake</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">email</span><span style="color:#89DDFF;">(),</span></span>
<span class="line"><span style="color:#82AAFF;">        </span><span style="color:#A6ACCD;font-style:italic;">address</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;"> fake</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">address</span><span style="color:#89DDFF;">()</span></span>
<span class="line"><span style="color:#82AAFF;">    </span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span></code></pre></div><p>执行之后，数据库会生成两条数据，如下图： <img src="`+t+`" alt="图 4"></p><h3 id="_3-批量添加数据" tabindex="-1">3.批量添加数据 <a class="header-anchor" href="#_3-批量添加数据" aria-label="Permalink to &quot;3.批量添加数据&quot;">​</a></h3><p>Tortoise ORM模型类中也封装了批量新增数据的函数bulk_create。 通过观察源码的注解，该方法调用方式，只要传入一个list列表，列表里的元素是user模型对象即可。</p><div class="language-python"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">async</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">def</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">bulk_add</span><span style="color:#89DDFF;">():</span></span>
<span class="line"><span style="color:#A6ACCD;">    usersList </span><span style="color:#89DDFF;">=[]</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;font-style:italic;">for</span><span style="color:#A6ACCD;"> _ </span><span style="color:#89DDFF;font-style:italic;">in</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">range</span><span style="color:#89DDFF;">(</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#F78C6C;">10</span><span style="color:#89DDFF;">):</span></span>
<span class="line"><span style="color:#A6ACCD;">        id_card </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> fake</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">ssn</span><span style="color:#89DDFF;">()</span></span>
<span class="line"><span style="color:#A6ACCD;">        user </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">userModel</span><span style="color:#89DDFF;">(</span></span>
<span class="line"><span style="color:#82AAFF;">            </span><span style="color:#A6ACCD;font-style:italic;">name</span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;">fake</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">name</span><span style="color:#89DDFF;">(),</span></span>
<span class="line"><span style="color:#82AAFF;">            </span><span style="color:#A6ACCD;font-style:italic;">phone</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;"> fake</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">phone_number</span><span style="color:#89DDFF;">(),</span></span>
<span class="line"><span style="color:#82AAFF;">            </span><span style="color:#A6ACCD;font-style:italic;">idcard</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;"> fake</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">ssn</span><span style="color:#89DDFF;">(),</span></span>
<span class="line"><span style="color:#82AAFF;">            </span><span style="color:#A6ACCD;font-style:italic;">birthDate</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;"> id_card</span><span style="color:#89DDFF;">[</span><span style="color:#F78C6C;">6</span><span style="color:#89DDFF;">:</span><span style="color:#F78C6C;">14</span><span style="color:#89DDFF;">],</span></span>
<span class="line"><span style="color:#82AAFF;">            </span><span style="color:#A6ACCD;font-style:italic;">email</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;"> fake</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">email</span><span style="color:#89DDFF;">(),</span></span>
<span class="line"><span style="color:#82AAFF;">            </span><span style="color:#A6ACCD;font-style:italic;">address</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;"> fake</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">address</span><span style="color:#89DDFF;">()</span></span>
<span class="line"><span style="color:#82AAFF;">        </span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">        usersList</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">append</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">user</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#A6ACCD;"> userModel</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">bulk_create</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">usersList</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span></code></pre></div><p>先通过一个for循环生成11个userModel对象，然后中通过调userModel的bulk_create方法，把这个11个用户信息写入数据库中。</p><p><img src="`+c+`" alt="图 3"></p><h2 id="删除-delete" tabindex="-1">删除(Delete) <a class="header-anchor" href="#删除-delete" aria-label="Permalink to &quot;删除(Delete)&quot;">​</a></h2><p>Tortoise ORM模型类中封装了Delete方法，通过过来查询出要删除的对象，然后再调用delete方法。核心代码如下：</p><div class="language-python"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">#删除ID为1的数据，返回的是被改的行数</span></span>
<span class="line"><span style="color:#C792EA;">async</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">def</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">deleteById</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">id</span><span style="color:#89DDFF;">):</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#A6ACCD;"> userModel</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">filter</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">id</span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;">id</span><span style="color:#89DDFF;">).</span><span style="color:#82AAFF;">delete</span><span style="color:#89DDFF;">()</span></span>
<span class="line"></span></code></pre></div><p>Tortoise ORM模型中没有封装批量删除的方式，后续可以根据自己的业务情况自行封装。</p><h2 id="修改-update" tabindex="-1">修改(update) <a class="header-anchor" href="#修改-update" aria-label="Permalink to &quot;修改(update)&quot;">​</a></h2><p>Tortoise ORM模型中封装了几个有关更新的方法，分别是update_from_dict、update_or_create、update。其中update是通过filter查询对象，再更新相应的字段。</p><div class="language-python"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">async</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">def</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">update</span><span style="color:#89DDFF;">():</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#A6ACCD;"> userModel</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">filter</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">id</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">2</span><span style="color:#89DDFF;">).</span><span style="color:#82AAFF;">update</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">address</span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;">fake</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">address</span><span style="color:#89DDFF;">())</span></span>
<span class="line"></span></code></pre></div><h2 id="查看-select" tabindex="-1">查看(select) <a class="header-anchor" href="#查看-select" aria-label="Permalink to &quot;查看(select)&quot;">​</a></h2><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>filter(*args, **kwargs)：使用给定的过滤器创建 QuerySet exclude(*args, **kwargs)：使用给定的排除过滤器创建 QuerySet all()：创建不带过滤器的查询集 first()：创建仅限于一个对象的查询集并返回实例而不是列表 annotate()： 使用额外的函数/聚合对结果进行再过滤</p></div><h3 id="_1-all" tabindex="-1">1.all <a class="header-anchor" href="#_1-all" aria-label="Permalink to &quot;1.all&quot;">​</a></h3><div class="language-python"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">#查询所有，返回是用户模型对象[&lt;userModel: 2&gt;,...]</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#A6ACCD;"> userModel</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">all</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">#过滤需要的字段，返回dict对象</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#A6ACCD;"> userModel</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">all</span><span style="color:#89DDFF;">().</span><span style="color:#82AAFF;">values</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">id</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">name</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#A6ACCD;"> userModel</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">all</span><span style="color:#89DDFF;">().</span><span style="color:#82AAFF;">order_by</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">-created</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">#排序，-是降序</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">#分页查询</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#A6ACCD;"> userModel</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">all</span><span style="color:#89DDFF;">().</span><span style="color:#82AAFF;">offset</span><span style="color:#89DDFF;">(</span><span style="color:#F78C6C;">2</span><span style="color:#89DDFF;">).</span><span style="color:#82AAFF;">limit</span><span style="color:#89DDFF;">(</span><span style="color:#F78C6C;">5</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span></code></pre></div><h3 id="_2-get" tabindex="-1">2.get <a class="header-anchor" href="#_2-get" aria-label="Permalink to &quot;2.get&quot;">​</a></h3><div class="language-python"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">#根据条件查询符合的对象，条件需唯一 return UserModel</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#A6ACCD;"> userModel</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">id</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">13</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">#查询不到返回None，避免出现对象不存在的异常</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#A6ACCD;"> userModel</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get_or_none</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">id</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">15</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span></code></pre></div><h3 id="_3-filter-条件过滤" tabindex="-1">3.filter 条件过滤 <a class="header-anchor" href="#_3-filter-条件过滤" aria-label="Permalink to &quot;3.filter 条件过滤&quot;">​</a></h3><p>其实filter的用法和get的差不多，都是通过条件过滤。</p><div class="language-python"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;"># 获取第一个符合条件的 return UserModel</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#A6ACCD;"> userModel</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">filter</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">name</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">林超</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">).</span><span style="color:#82AAFF;">first</span><span style="color:#89DDFF;">()</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 获取原生sql</span></span>
<span class="line"><span style="color:#A6ACCD;">userModel</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">filter</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">name</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">林超</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">).</span><span style="color:#82AAFF;">sql</span><span style="color:#89DDFF;">()</span></span>
<span class="line"></span></code></pre></div><div class="tip custom-block"><p class="custom-block-title">TIP</p><ul><li>in：检查字段的值是否在传递列表中</li><li>not_in: 检查字段的值是不在传递列表中</li><li>gte：大于或等于传递的值</li><li>gt：大于传递值</li><li>lte：低于或等于传递的值</li><li>lt：低于通过值</li><li>range：介于和给定两个值之间</li><li>isnull：字段为空</li><li>not_isnull：字段不为空</li><li>contains：字段包含指定的子字符串</li><li>icontains：不区分大小写contains</li><li>startswith：如果字段以值开头</li><li>istartswith：不区分大小写startswith</li><li>endswith：如果字段以值结尾</li><li>iendswith：不区分大小写endswith</li><li>iexact：不区分大小写等于</li><li>search：全文搜索</li></ul></div><h3 id="原生sql" tabindex="-1">原生SQL <a class="header-anchor" href="#原生sql" aria-label="Permalink to &quot;原生SQL&quot;">​</a></h3><p>在项目中有时候可能需要执行原生的SQL语言。可以使用下面的方式执行：</p><div class="language-python"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">async</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">def</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">executSQL</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">sql</span><span style="color:#89DDFF;">):</span></span>
<span class="line"><span style="color:#A6ACCD;">    conn </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> connections</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">default</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    res</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#A6ACCD;"> conn</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">execute_query_dict</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">sql</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> res</span></span>
<span class="line"></span></code></pre></div><h2 id="filter-q" tabindex="-1">filter Q <a class="header-anchor" href="#filter-q" aria-label="Permalink to &quot;filter Q&quot;">​</a></h2><p>Q对象用于创建</p><ul><li>创建 OR 过滤器</li><li>嵌套过滤器</li><li>倒置过滤器</li><li>结合以上任何一种来简单地编写复杂的多层过滤器 在使用之前先执行如下代码引入依赖</li></ul><div class="language-python"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> tortoise</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">models </span><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> Q</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#A6ACCD;"> userModel</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">filter</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">Q</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">name</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">蒋洁</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;font-style:italic;">id</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">13</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;font-style:italic;">join_type</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">OR</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)).</span><span style="color:#82AAFF;">all</span><span style="color:#89DDFF;">()</span></span>
<span class="line"></span></code></pre></div><p>关于Q的更多用法请查阅<a href="https://tortoise.github.io/expressions.html?h=q#tortoise.models.Model.in_bulk" target="_blank" rel="noreferrer">官方文档</a></p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">Q(</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">*</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">args</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">join_type</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">AND</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">**</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">kwargs</span><span style="color:#A6ACCD;"> )</span></span>
<span class="line"></span></code></pre></div><div class="tip custom-block"><p class="custom-block-title">TIP</p><ul><li>join_type：连接类型，OR\\AND</li><li>args ( Q) ：Q要包装的内部表达式</li><li>kwargs ( Any) ：此 Q 对象应封装的过滤语句</li></ul></div><h2 id="f表达式" tabindex="-1">F表达式 <a class="header-anchor" href="#f表达式" aria-label="Permalink to &quot;F表达式&quot;">​</a></h2><p>F对象表示模型字段的值。它可以引用模型字段值并使用它们执行数据库操作，而无需将它们从数据库中拉出到 Python 内存中</p><div class="language-python"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> tortoise</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">expressions </span><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> F</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#A6ACCD;"> User</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">filter</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">id</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">).</span><span style="color:#82AAFF;">update</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">balance</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;"> F</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">balance</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">)</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">-</span><span style="color:#82AAFF;"> </span><span style="color:#F78C6C;">10</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#A6ACCD;"> User</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">filter</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">id</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">).</span><span style="color:#82AAFF;">update</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">balance</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;"> F</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">balance</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">)</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">+</span><span style="color:#82AAFF;"> F</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">award</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">),</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;font-style:italic;">award</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># or use .save()</span></span>
<span class="line"><span style="color:#A6ACCD;">user </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#A6ACCD;"> User</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">id</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">user</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">balance</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">F</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">balance</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">10</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#A6ACCD;"> user</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">save</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">update_fields</span><span style="color:#89DDFF;">=[</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">balance</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">])</span></span>
<span class="line"></span></code></pre></div>`,50),i=[F,y,D];function A(C,d,u,f,h,m){return n(),o("div",null,i)}const g=l(r,[["render",A]]);export{b as __pageData,g as default};
