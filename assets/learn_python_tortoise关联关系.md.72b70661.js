import{_ as s,o as n,c as a,Q as l}from"./chunks/framework.c9ba2ff1.js";const q=JSON.parse('{"title":"tortoise关联关系","description":"tortoise 关联关系（外键、多对多）相关问题","frontmatter":{"title":"tortoise关联关系","description":"tortoise 关联关系（外键、多对多）相关问题","date":"2023-4-10","recommend":1,"sticky":3,"tags":["python","项目实战","tortoise","fastapi"],"categories":["python"]},"headers":[],"relativePath":"learn/python/tortoise关联关系.md","filePath":"learn/python/tortoise关联关系.md"}'),o={name:"learn/python/tortoise关联关系.md"},p=l(`<h1 id="tortoise-关联关系-外键、多对多-相关问题" tabindex="-1">tortoise 关联关系（外键、多对多）相关问题 <a class="header-anchor" href="#tortoise-关联关系-外键、多对多-相关问题" aria-label="Permalink to &quot;tortoise 关联关系（外键、多对多）相关问题&quot;">​</a></h1><p>主要介绍在<strong>tortoise-orm</strong>中使用pydantic_model_creator创建Pydantic时,关联关系出现的一些问题、关联字段丢失、继承失败等</p><h2 id="使用全局初始化关联关系" tabindex="-1">使用全局初始化关联关系 <a class="header-anchor" href="#使用全局初始化关联关系" aria-label="Permalink to &quot;使用全局初始化关联关系&quot;">​</a></h2><p>全局初始化会使所有模型的外键、一对多、多对多等关系自动建立，这个适用于关联关系简单的数据库表。</p><ul><li>优点：简单易用，不用手动简历关联关系</li><li>缺点：适用于简单关联关系表，自定义关系字段时比较麻烦，需要手动exclude排除多余的关联字段</li></ul><p>实现方法如下,在<strong>setting.py</strong>中数据库配置：</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#79B8FF;">DATABASE_CONFIG</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">&quot;connections&quot;</span><span style="color:#E1E4E8;">: {</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#9ECBFF;">&quot;default&quot;</span><span style="color:#E1E4E8;">: {</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#9ECBFF;">&quot;engine&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;tortoise.backends.mysql&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#9ECBFF;">&quot;credentials&quot;</span><span style="color:#E1E4E8;">: {</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#9ECBFF;">&quot;host&quot;</span><span style="color:#E1E4E8;">: os.getenv(</span><span style="color:#9ECBFF;">&quot;DATABASE_HOST&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">PROJECT_CONFIG</span><span style="color:#E1E4E8;">[</span><span style="color:#9ECBFF;">&quot;database&quot;</span><span style="color:#E1E4E8;">][</span><span style="color:#9ECBFF;">&quot;host&quot;</span><span style="color:#E1E4E8;">]),</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#6A737D;"># FS_DATABASE_HOST 数据库名称环境变量根据需求修改</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#9ECBFF;">&quot;port&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">int</span><span style="color:#E1E4E8;">(os.getenv(</span><span style="color:#9ECBFF;">&quot;DATABASE_PORT&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">PROJECT_CONFIG</span><span style="color:#E1E4E8;">[</span><span style="color:#9ECBFF;">&quot;database&quot;</span><span style="color:#E1E4E8;">][</span><span style="color:#9ECBFF;">&quot;port&quot;</span><span style="color:#E1E4E8;">])),</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#9ECBFF;">&quot;user&quot;</span><span style="color:#E1E4E8;">: os.getenv(</span><span style="color:#9ECBFF;">&quot;DATABASE_USER&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">PROJECT_CONFIG</span><span style="color:#E1E4E8;">[</span><span style="color:#9ECBFF;">&quot;database&quot;</span><span style="color:#E1E4E8;">][</span><span style="color:#9ECBFF;">&quot;user&quot;</span><span style="color:#E1E4E8;">]),</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#9ECBFF;">&quot;password&quot;</span><span style="color:#E1E4E8;">: os.getenv(</span><span style="color:#9ECBFF;">&quot;DATABASE_PASSWORD&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">PROJECT_CONFIG</span><span style="color:#E1E4E8;">[</span><span style="color:#9ECBFF;">&quot;database&quot;</span><span style="color:#E1E4E8;">][</span><span style="color:#9ECBFF;">&quot;password&quot;</span><span style="color:#E1E4E8;">]),</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#9ECBFF;">&quot;database&quot;</span><span style="color:#E1E4E8;">: os.getenv(</span><span style="color:#9ECBFF;">&quot;DATABASE_NAME&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">PROJECT_CONFIG</span><span style="color:#E1E4E8;">[</span><span style="color:#9ECBFF;">&quot;database&quot;</span><span style="color:#E1E4E8;">][</span><span style="color:#9ECBFF;">&quot;db_name&quot;</span><span style="color:#E1E4E8;">]),</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#9ECBFF;">&quot;minsize&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">PROJECT_CONFIG</span><span style="color:#E1E4E8;">[</span><span style="color:#9ECBFF;">&quot;database&quot;</span><span style="color:#E1E4E8;">][</span><span style="color:#9ECBFF;">&quot;minsize&quot;</span><span style="color:#E1E4E8;">],</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#9ECBFF;">&quot;maxsize&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">PROJECT_CONFIG</span><span style="color:#E1E4E8;">[</span><span style="color:#9ECBFF;">&quot;database&quot;</span><span style="color:#E1E4E8;">][</span><span style="color:#9ECBFF;">&quot;maxsize&quot;</span><span style="color:#E1E4E8;">],</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#9ECBFF;">&quot;charset&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;utf8mb4&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#9ECBFF;">&quot;pool_recycle&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">PROJECT_CONFIG</span><span style="color:#E1E4E8;">[</span><span style="color:#9ECBFF;">&quot;database&quot;</span><span style="color:#E1E4E8;">][</span><span style="color:#9ECBFF;">&quot;pool_recycle&quot;</span><span style="color:#E1E4E8;">],</span></span>
<span class="line"><span style="color:#E1E4E8;">            }</span></span>
<span class="line"><span style="color:#E1E4E8;">        },</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    },</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">&quot;apps&quot;</span><span style="color:#E1E4E8;">: {</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#6A737D;"># 1.注意此处的app代表的并不与FastAPI的routers对应，为Tortoise中的app概念</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#6A737D;"># 2.在Tortoise-orm使用外键时，需要用到该app名称来指执行模型，&quot;app.model&quot;，所以同一个app中不要出现名称相同的两个模型类</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#6A737D;"># 3.app的划分结合 规则2与实际情况进行划分即可</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#9ECBFF;">&quot;cp_model&quot;</span><span style="color:#E1E4E8;">: {</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#9ECBFF;">&quot;models&quot;</span><span style="color:#E1E4E8;">: [</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#9ECBFF;">&quot;src.faster.database.models&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">            ],</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#9ECBFF;">&quot;default_connection&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;default&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">        },</span></span>
<span class="line"><span style="color:#E1E4E8;">    },</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">&quot;routers&quot;</span><span style="color:#E1E4E8;">: [</span><span style="color:#9ECBFF;">&quot;src.my_tools.tortoise_tools.routers.WriteOrReadRouter&quot;</span><span style="color:#E1E4E8;">],</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">#设置数据库总是存储utc时间</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">&quot;use_tz&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">True</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;"># &quot;timezone&quot;: DEFAULT_TIMEZONE,  # 设置时区转换，即从数据库取出utc时间后会被转换为timezone所指定的时区时间（待验证）</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">&quot;timezone&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">LOCAL_TIMEZONE</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#005CC5;">DATABASE_CONFIG</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#032F62;">&quot;connections&quot;</span><span style="color:#24292E;">: {</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#032F62;">&quot;default&quot;</span><span style="color:#24292E;">: {</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#032F62;">&quot;engine&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;tortoise.backends.mysql&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#032F62;">&quot;credentials&quot;</span><span style="color:#24292E;">: {</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#032F62;">&quot;host&quot;</span><span style="color:#24292E;">: os.getenv(</span><span style="color:#032F62;">&quot;DATABASE_HOST&quot;</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">PROJECT_CONFIG</span><span style="color:#24292E;">[</span><span style="color:#032F62;">&quot;database&quot;</span><span style="color:#24292E;">][</span><span style="color:#032F62;">&quot;host&quot;</span><span style="color:#24292E;">]),</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#6A737D;"># FS_DATABASE_HOST 数据库名称环境变量根据需求修改</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#032F62;">&quot;port&quot;</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">int</span><span style="color:#24292E;">(os.getenv(</span><span style="color:#032F62;">&quot;DATABASE_PORT&quot;</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">PROJECT_CONFIG</span><span style="color:#24292E;">[</span><span style="color:#032F62;">&quot;database&quot;</span><span style="color:#24292E;">][</span><span style="color:#032F62;">&quot;port&quot;</span><span style="color:#24292E;">])),</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#032F62;">&quot;user&quot;</span><span style="color:#24292E;">: os.getenv(</span><span style="color:#032F62;">&quot;DATABASE_USER&quot;</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">PROJECT_CONFIG</span><span style="color:#24292E;">[</span><span style="color:#032F62;">&quot;database&quot;</span><span style="color:#24292E;">][</span><span style="color:#032F62;">&quot;user&quot;</span><span style="color:#24292E;">]),</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#032F62;">&quot;password&quot;</span><span style="color:#24292E;">: os.getenv(</span><span style="color:#032F62;">&quot;DATABASE_PASSWORD&quot;</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">PROJECT_CONFIG</span><span style="color:#24292E;">[</span><span style="color:#032F62;">&quot;database&quot;</span><span style="color:#24292E;">][</span><span style="color:#032F62;">&quot;password&quot;</span><span style="color:#24292E;">]),</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#032F62;">&quot;database&quot;</span><span style="color:#24292E;">: os.getenv(</span><span style="color:#032F62;">&quot;DATABASE_NAME&quot;</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">PROJECT_CONFIG</span><span style="color:#24292E;">[</span><span style="color:#032F62;">&quot;database&quot;</span><span style="color:#24292E;">][</span><span style="color:#032F62;">&quot;db_name&quot;</span><span style="color:#24292E;">]),</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#032F62;">&quot;minsize&quot;</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">PROJECT_CONFIG</span><span style="color:#24292E;">[</span><span style="color:#032F62;">&quot;database&quot;</span><span style="color:#24292E;">][</span><span style="color:#032F62;">&quot;minsize&quot;</span><span style="color:#24292E;">],</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#032F62;">&quot;maxsize&quot;</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">PROJECT_CONFIG</span><span style="color:#24292E;">[</span><span style="color:#032F62;">&quot;database&quot;</span><span style="color:#24292E;">][</span><span style="color:#032F62;">&quot;maxsize&quot;</span><span style="color:#24292E;">],</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#032F62;">&quot;charset&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;utf8mb4&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#032F62;">&quot;pool_recycle&quot;</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">PROJECT_CONFIG</span><span style="color:#24292E;">[</span><span style="color:#032F62;">&quot;database&quot;</span><span style="color:#24292E;">][</span><span style="color:#032F62;">&quot;pool_recycle&quot;</span><span style="color:#24292E;">],</span></span>
<span class="line"><span style="color:#24292E;">            }</span></span>
<span class="line"><span style="color:#24292E;">        },</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    },</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#032F62;">&quot;apps&quot;</span><span style="color:#24292E;">: {</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;"># 1.注意此处的app代表的并不与FastAPI的routers对应，为Tortoise中的app概念</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;"># 2.在Tortoise-orm使用外键时，需要用到该app名称来指执行模型，&quot;app.model&quot;，所以同一个app中不要出现名称相同的两个模型类</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;"># 3.app的划分结合 规则2与实际情况进行划分即可</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#032F62;">&quot;cp_model&quot;</span><span style="color:#24292E;">: {</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#032F62;">&quot;models&quot;</span><span style="color:#24292E;">: [</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#032F62;">&quot;src.faster.database.models&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">            ],</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#032F62;">&quot;default_connection&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;default&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">        },</span></span>
<span class="line"><span style="color:#24292E;">    },</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#032F62;">&quot;routers&quot;</span><span style="color:#24292E;">: [</span><span style="color:#032F62;">&quot;src.my_tools.tortoise_tools.routers.WriteOrReadRouter&quot;</span><span style="color:#24292E;">],</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">#设置数据库总是存储utc时间</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#032F62;">&quot;use_tz&quot;</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">True</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;"># &quot;timezone&quot;: DEFAULT_TIMEZONE,  # 设置时区转换，即从数据库取出utc时间后会被转换为timezone所指定的时区时间（待验证）</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#032F62;">&quot;timezone&quot;</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">LOCAL_TIMEZONE</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div><p>在routers的<strong>init.py</strong>中最上面写这行初始化代码：</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> src.settings </span><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">DATABASE_CONFIG</span></span>
<span class="line"><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> tortoise </span><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> Tortoise</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 在模型schema初始化前，调用外键关联</span></span>
<span class="line"><span style="color:#6A737D;"># 1.这将调用Tortoise子带的外键关联，如果想自定义外键关联的字段，需要自己写Pydantic</span></span>
<span class="line"><span style="color:#6A737D;"># 2.如果想偷懒只要能返回外键关联信息，则使用此方法</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">Tortoise.init_models(</span><span style="color:#79B8FF;">DATABASE_CONFIG</span><span style="color:#E1E4E8;">[</span><span style="color:#9ECBFF;">&quot;apps&quot;</span><span style="color:#E1E4E8;">][</span><span style="color:#9ECBFF;">&quot;cp_model&quot;</span><span style="color:#E1E4E8;">][</span><span style="color:#9ECBFF;">&quot;models&quot;</span><span style="color:#E1E4E8;">], </span><span style="color:#9ECBFF;">&quot;cp_model&quot;</span><span style="color:#E1E4E8;">)</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">from</span><span style="color:#24292E;"> src.settings </span><span style="color:#D73A49;">import</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">DATABASE_CONFIG</span></span>
<span class="line"><span style="color:#D73A49;">from</span><span style="color:#24292E;"> tortoise </span><span style="color:#D73A49;">import</span><span style="color:#24292E;"> Tortoise</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 在模型schema初始化前，调用外键关联</span></span>
<span class="line"><span style="color:#6A737D;"># 1.这将调用Tortoise子带的外键关联，如果想自定义外键关联的字段，需要自己写Pydantic</span></span>
<span class="line"><span style="color:#6A737D;"># 2.如果想偷懒只要能返回外键关联信息，则使用此方法</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">Tortoise.init_models(</span><span style="color:#005CC5;">DATABASE_CONFIG</span><span style="color:#24292E;">[</span><span style="color:#032F62;">&quot;apps&quot;</span><span style="color:#24292E;">][</span><span style="color:#032F62;">&quot;cp_model&quot;</span><span style="color:#24292E;">][</span><span style="color:#032F62;">&quot;models&quot;</span><span style="color:#24292E;">], </span><span style="color:#032F62;">&quot;cp_model&quot;</span><span style="color:#24292E;">)</span></span></code></pre></div><div class="tip custom-block"><p class="custom-block-title">重要提示</p><p>若需要自动生成外键关联，则需要在模型schema初始化前，调用外键关联。也就是要在导入各个routers之前初始化关联关系，否则会无效。</p></div><h2 id="自定义关联关系字段" tabindex="-1">自定义关联关系字段 <a class="header-anchor" href="#自定义关联关系字段" aria-label="Permalink to &quot;自定义关联关系字段&quot;">​</a></h2><p>在创建Pydantic时，用户可以根据表字段的关联关系自定义。适合复杂关系表的Pydantic建立关联字段。 这个时候需要注释掉上面的自动关联关系的初始化代码。 拿一个论坛项目的几张表做例子，先举例数据模型：</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">class</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Post</span><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">models</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">Model</span><span style="color:#E1E4E8;">):</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">&quot;&quot;&quot;岗位表&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">id</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> fields.CharField(</span><span style="color:#FFAB70;">max_length</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">50</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">pk</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">True</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">    name </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> fields.CharField(</span><span style="color:#FFAB70;">max_length</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">32</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">null</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">False</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">default</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&quot;&quot;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">class</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Department</span><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">AbstractDefaultColumn</span><span style="color:#E1E4E8;">):</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">&quot;&quot;&quot;部门表&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">id</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> fields.CharField(</span><span style="color:#FFAB70;">max_length</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">50</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">pk</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">True</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">    name </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> fields.CharField(</span><span style="color:#FFAB70;">max_length</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">64</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">help_text</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&#39;部门名&#39;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">class</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">User</span><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">models</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">Model</span><span style="color:#E1E4E8;">):</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">&quot;&quot;&quot;用户表&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">id</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> fields.IntField(</span><span style="color:#FFAB70;">pk</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">True</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">    name </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> fields.CharField(</span><span style="color:#FFAB70;">max_length</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">32</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">index</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">True</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">    phone_no </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> fields.CharField(</span><span style="color:#FFAB70;">max_length</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">32</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">unique</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">True</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">    email </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> fields.CharField(</span><span style="color:#FFAB70;">max_length</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">32</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">null</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">True</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">    department </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> fields.ForeignKeyField(</span><span style="color:#9ECBFF;">&quot;cp_model.Department&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">on_delete</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">fields.</span><span style="color:#79B8FF;">SET_NULL</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">null</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">True</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">                                        </span><span style="color:#FFAB70;">related_name</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&quot;depart_users&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">help_text</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&#39;所属部门&#39;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">    post </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> fields.ForeignKeyField(</span><span style="color:#9ECBFF;">&quot;cp_model.Post&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">on_delete</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">fields.</span><span style="color:#79B8FF;">SET_NULL</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">null</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">True</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">related_name</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&quot;post_users&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">                                  </span><span style="color:#FFAB70;">help_text</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&#39;岗位&#39;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">class</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">ForumArticle</span><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">AbstractDefaultColumn</span><span style="color:#E1E4E8;">):</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">&quot;&quot;&quot;文章&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">id</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> fields.IntField(</span><span style="color:#FFAB70;">pk</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">True</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">    user </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> fields.ForeignKeyField(</span><span style="color:#9ECBFF;">&quot;cp_model.User&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">on_delete</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">fields.</span><span style="color:#79B8FF;">CASCADE</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">    title </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> fields.CharField(</span><span style="color:#FFAB70;">max_length</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">32</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">default</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&#39;&#39;</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">null</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">True</span><span style="color:#E1E4E8;">)  </span><span style="color:#6A737D;"># 文章标题</span></span>
<span class="line"><span style="color:#E1E4E8;">    content </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> fields.TextField(</span><span style="color:#FFAB70;">default</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&#39;&#39;</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">null</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">True</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">blank</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">True</span><span style="color:#E1E4E8;">)  </span><span style="color:#6A737D;"># 文章正文</span></span>
<span class="line"><span style="color:#E1E4E8;">    tags </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> fields.ManyToManyField(</span><span style="color:#9ECBFF;">&#39;cp_model.ArticleTag&#39;</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">related_name</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&#39;tags_article&#39;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">                                  </span><span style="color:#FFAB70;">through</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&quot;cp_forum_article_tags&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">                                  </span><span style="color:#FFAB70;">forward_key</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&quot;cp_tag_id&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">                                  </span><span style="color:#FFAB70;">backward_key</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&quot;cp_forum_article_id&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">                                  )  </span><span style="color:#6A737D;"># 标签</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    posters </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> fields.ManyToManyField(</span><span style="color:#9ECBFF;">&quot;cp_model.CPImage&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">related_name</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&quot;posters_article&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">                                     </span><span style="color:#FFAB70;">through</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&quot;cp_forum_article_posters&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">                                     </span><span style="color:#FFAB70;">forward_key</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&quot;cp_image_id&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">                                     </span><span style="color:#FFAB70;">backward_key</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&quot;cp_forum_article_id&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">                                     )</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">class</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">ArticleComment</span><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">AbstractDefaultColumn</span><span style="color:#E1E4E8;">):</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">&quot;&quot;&quot;评论&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">id</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> fields.IntField(</span><span style="color:#FFAB70;">pk</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">True</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">    user </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> fields.ForeignKeyField(</span><span style="color:#9ECBFF;">&quot;cp_model.User&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">related_name</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&quot;user_comments&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">on_delete</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">fields.</span><span style="color:#79B8FF;">CASCADE</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">    to_user_id </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> fields.IntField(</span><span style="color:#FFAB70;">default</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">)  </span><span style="color:#6A737D;"># 回复用户的id</span></span>
<span class="line"><span style="color:#E1E4E8;">    to_user_name </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> fields.CharField(</span><span style="color:#FFAB70;">max_length</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">32</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">default</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&quot;&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">null</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">True</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">blank</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">True</span><span style="color:#E1E4E8;">)  </span><span style="color:#6A737D;"># 回复用户的name</span></span>
<span class="line"><span style="color:#E1E4E8;">    article </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> fields.ForeignKeyField(</span><span style="color:#9ECBFF;">&quot;cp_model.ForumArticle&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">on_delete</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">fields.</span><span style="color:#79B8FF;">SET_NULL</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">null</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">True</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">                                     </span><span style="color:#FFAB70;">related_name</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&quot;article_comments&quot;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">class</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">ArticleUpvoteRecord</span><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">AbstractDefaultColumn</span><span style="color:#E1E4E8;">):</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">&quot;&quot;&quot;用户论坛文章的点赞记录&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">id</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> fields.IntField(</span><span style="color:#FFAB70;">pk</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">True</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">    user </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> fields.ForeignKeyField(</span><span style="color:#9ECBFF;">&quot;cp_model.User&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">related_name</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&quot;user_article_upvotes&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">on_delete</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">fields.</span><span style="color:#79B8FF;">CASCADE</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">    article </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> fields.ForeignKeyField(</span><span style="color:#9ECBFF;">&quot;cp_model.ForumArticle&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">related_name</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&quot;article_upvotes&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">on_delete</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">fields.</span><span style="color:#79B8FF;">CASCADE</span><span style="color:#E1E4E8;">)</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">class</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Post</span><span style="color:#24292E;">(</span><span style="color:#6F42C1;">models</span><span style="color:#24292E;">.</span><span style="color:#6F42C1;">Model</span><span style="color:#24292E;">):</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#032F62;">&quot;&quot;&quot;岗位表&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#005CC5;">id</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> fields.CharField(</span><span style="color:#E36209;">max_length</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">50</span><span style="color:#24292E;">, </span><span style="color:#E36209;">pk</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">True</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">    name </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> fields.CharField(</span><span style="color:#E36209;">max_length</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">32</span><span style="color:#24292E;">, </span><span style="color:#E36209;">null</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">False</span><span style="color:#24292E;">, </span><span style="color:#E36209;">default</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;&quot;</span><span style="color:#24292E;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">class</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Department</span><span style="color:#24292E;">(</span><span style="color:#6F42C1;">AbstractDefaultColumn</span><span style="color:#24292E;">):</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#032F62;">&quot;&quot;&quot;部门表&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#005CC5;">id</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> fields.CharField(</span><span style="color:#E36209;">max_length</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">50</span><span style="color:#24292E;">, </span><span style="color:#E36209;">pk</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">True</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">    name </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> fields.CharField(</span><span style="color:#E36209;">max_length</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">64</span><span style="color:#24292E;">, </span><span style="color:#E36209;">help_text</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&#39;部门名&#39;</span><span style="color:#24292E;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">class</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">User</span><span style="color:#24292E;">(</span><span style="color:#6F42C1;">models</span><span style="color:#24292E;">.</span><span style="color:#6F42C1;">Model</span><span style="color:#24292E;">):</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#032F62;">&quot;&quot;&quot;用户表&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#005CC5;">id</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> fields.IntField(</span><span style="color:#E36209;">pk</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">True</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">    name </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> fields.CharField(</span><span style="color:#E36209;">max_length</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">32</span><span style="color:#24292E;">, </span><span style="color:#E36209;">index</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">True</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">    phone_no </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> fields.CharField(</span><span style="color:#E36209;">max_length</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">32</span><span style="color:#24292E;">, </span><span style="color:#E36209;">unique</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">True</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">    email </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> fields.CharField(</span><span style="color:#E36209;">max_length</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">32</span><span style="color:#24292E;">, </span><span style="color:#E36209;">null</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">True</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">    department </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> fields.ForeignKeyField(</span><span style="color:#032F62;">&quot;cp_model.Department&quot;</span><span style="color:#24292E;">, </span><span style="color:#E36209;">on_delete</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">fields.</span><span style="color:#005CC5;">SET_NULL</span><span style="color:#24292E;">, </span><span style="color:#E36209;">null</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">True</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">                                        </span><span style="color:#E36209;">related_name</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;depart_users&quot;</span><span style="color:#24292E;">, </span><span style="color:#E36209;">help_text</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&#39;所属部门&#39;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">    post </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> fields.ForeignKeyField(</span><span style="color:#032F62;">&quot;cp_model.Post&quot;</span><span style="color:#24292E;">, </span><span style="color:#E36209;">on_delete</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">fields.</span><span style="color:#005CC5;">SET_NULL</span><span style="color:#24292E;">, </span><span style="color:#E36209;">null</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">True</span><span style="color:#24292E;">, </span><span style="color:#E36209;">related_name</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;post_users&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">                                  </span><span style="color:#E36209;">help_text</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&#39;岗位&#39;</span><span style="color:#24292E;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">class</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">ForumArticle</span><span style="color:#24292E;">(</span><span style="color:#6F42C1;">AbstractDefaultColumn</span><span style="color:#24292E;">):</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#032F62;">&quot;&quot;&quot;文章&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#005CC5;">id</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> fields.IntField(</span><span style="color:#E36209;">pk</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">True</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">    user </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> fields.ForeignKeyField(</span><span style="color:#032F62;">&quot;cp_model.User&quot;</span><span style="color:#24292E;">, </span><span style="color:#E36209;">on_delete</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">fields.</span><span style="color:#005CC5;">CASCADE</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">    title </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> fields.CharField(</span><span style="color:#E36209;">max_length</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">32</span><span style="color:#24292E;">, </span><span style="color:#E36209;">default</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&#39;&#39;</span><span style="color:#24292E;">, </span><span style="color:#E36209;">null</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">True</span><span style="color:#24292E;">)  </span><span style="color:#6A737D;"># 文章标题</span></span>
<span class="line"><span style="color:#24292E;">    content </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> fields.TextField(</span><span style="color:#E36209;">default</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&#39;&#39;</span><span style="color:#24292E;">, </span><span style="color:#E36209;">null</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">True</span><span style="color:#24292E;">, </span><span style="color:#E36209;">blank</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">True</span><span style="color:#24292E;">)  </span><span style="color:#6A737D;"># 文章正文</span></span>
<span class="line"><span style="color:#24292E;">    tags </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> fields.ManyToManyField(</span><span style="color:#032F62;">&#39;cp_model.ArticleTag&#39;</span><span style="color:#24292E;">, </span><span style="color:#E36209;">related_name</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&#39;tags_article&#39;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">                                  </span><span style="color:#E36209;">through</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;cp_forum_article_tags&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">                                  </span><span style="color:#E36209;">forward_key</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;cp_tag_id&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">                                  </span><span style="color:#E36209;">backward_key</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;cp_forum_article_id&quot;</span></span>
<span class="line"><span style="color:#24292E;">                                  )  </span><span style="color:#6A737D;"># 标签</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    posters </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> fields.ManyToManyField(</span><span style="color:#032F62;">&quot;cp_model.CPImage&quot;</span><span style="color:#24292E;">, </span><span style="color:#E36209;">related_name</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;posters_article&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">                                     </span><span style="color:#E36209;">through</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;cp_forum_article_posters&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">                                     </span><span style="color:#E36209;">forward_key</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;cp_image_id&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">                                     </span><span style="color:#E36209;">backward_key</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;cp_forum_article_id&quot;</span></span>
<span class="line"><span style="color:#24292E;">                                     )</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">class</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">ArticleComment</span><span style="color:#24292E;">(</span><span style="color:#6F42C1;">AbstractDefaultColumn</span><span style="color:#24292E;">):</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#032F62;">&quot;&quot;&quot;评论&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#005CC5;">id</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> fields.IntField(</span><span style="color:#E36209;">pk</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">True</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">    user </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> fields.ForeignKeyField(</span><span style="color:#032F62;">&quot;cp_model.User&quot;</span><span style="color:#24292E;">, </span><span style="color:#E36209;">related_name</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;user_comments&quot;</span><span style="color:#24292E;">, </span><span style="color:#E36209;">on_delete</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">fields.</span><span style="color:#005CC5;">CASCADE</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">    to_user_id </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> fields.IntField(</span><span style="color:#E36209;">default</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">0</span><span style="color:#24292E;">)  </span><span style="color:#6A737D;"># 回复用户的id</span></span>
<span class="line"><span style="color:#24292E;">    to_user_name </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> fields.CharField(</span><span style="color:#E36209;">max_length</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">32</span><span style="color:#24292E;">, </span><span style="color:#E36209;">default</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;&quot;</span><span style="color:#24292E;">, </span><span style="color:#E36209;">null</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">True</span><span style="color:#24292E;">, </span><span style="color:#E36209;">blank</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">True</span><span style="color:#24292E;">)  </span><span style="color:#6A737D;"># 回复用户的name</span></span>
<span class="line"><span style="color:#24292E;">    article </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> fields.ForeignKeyField(</span><span style="color:#032F62;">&quot;cp_model.ForumArticle&quot;</span><span style="color:#24292E;">, </span><span style="color:#E36209;">on_delete</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">fields.</span><span style="color:#005CC5;">SET_NULL</span><span style="color:#24292E;">, </span><span style="color:#E36209;">null</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">True</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">                                     </span><span style="color:#E36209;">related_name</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;article_comments&quot;</span><span style="color:#24292E;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">class</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">ArticleUpvoteRecord</span><span style="color:#24292E;">(</span><span style="color:#6F42C1;">AbstractDefaultColumn</span><span style="color:#24292E;">):</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#032F62;">&quot;&quot;&quot;用户论坛文章的点赞记录&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#005CC5;">id</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> fields.IntField(</span><span style="color:#E36209;">pk</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">True</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">    user </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> fields.ForeignKeyField(</span><span style="color:#032F62;">&quot;cp_model.User&quot;</span><span style="color:#24292E;">, </span><span style="color:#E36209;">related_name</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;user_article_upvotes&quot;</span><span style="color:#24292E;">, </span><span style="color:#E36209;">on_delete</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">fields.</span><span style="color:#005CC5;">CASCADE</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">    article </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> fields.ForeignKeyField(</span><span style="color:#032F62;">&quot;cp_model.ForumArticle&quot;</span><span style="color:#24292E;">, </span><span style="color:#E36209;">related_name</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;article_upvotes&quot;</span><span style="color:#24292E;">, </span><span style="color:#E36209;">on_delete</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">fields.</span><span style="color:#005CC5;">CASCADE</span><span style="color:#24292E;">)</span></span></code></pre></div><h3 id="外键关系" tabindex="-1">外键关系 <a class="header-anchor" href="#外键关系" aria-label="Permalink to &quot;外键关系&quot;">​</a></h3><div class="tip custom-block"><p class="custom-block-title">TIP</p><ul><li>如果模型字段比较多，但是序列化给前端只要几个字段，可以通过include添加字段，只会序列化include里面的字段和Pydantic里面用户自己添加的字段。</li><li>如果模型字段比较少，就可以通过exclude来排除不需要的字段，会序列化模型所有字段除去exclude里面的字段。exclude和include都不写就序列化模型所有的字段。</li></ul></div><p>用户Pyandtic:</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">class</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">PostSimpleSchema</span><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">pydantic_model_creator</span><span style="color:#E1E4E8;">(Post, </span><span style="color:#FFAB70;">name</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&quot;PostSimpleSchema&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">exclude</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">())):</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">&quot;&quot;&quot;职位&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">pass</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">class</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">UserSimpleSchema</span><span style="color:#E1E4E8;">(</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">pydantic_model_creator</span><span style="color:#E1E4E8;">(</span></span>
<span class="line"><span style="color:#E1E4E8;">        User, </span><span style="color:#FFAB70;">name</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&quot;UserSimpleSchema&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">include</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;id&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;name&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;image&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;post&quot;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">   )</span></span>
<span class="line"><span style="color:#E1E4E8;">):</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">&quot;&quot;&quot;简单展示用户信息，通过include只会序列化这四个字段&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">id</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">int</span></span>
<span class="line"><span style="color:#E1E4E8;">    name: </span><span style="color:#79B8FF;">str</span></span>
<span class="line"><span style="color:#E1E4E8;">    image: </span><span style="color:#79B8FF;">str</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">None</span></span>
<span class="line"><span style="color:#E1E4E8;">    post: PostSimpleSchema </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">None</span><span style="color:#E1E4E8;">   </span><span style="color:#6A737D;"># 外键岗位字段关系序列化</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">pass</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">class</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">PostSimpleSchema</span><span style="color:#24292E;">(</span><span style="color:#6F42C1;">pydantic_model_creator</span><span style="color:#24292E;">(Post, </span><span style="color:#E36209;">name</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;PostSimpleSchema&quot;</span><span style="color:#24292E;">, </span><span style="color:#E36209;">exclude</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">())):</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#032F62;">&quot;&quot;&quot;职位&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">pass</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">class</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">UserSimpleSchema</span><span style="color:#24292E;">(</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">pydantic_model_creator</span><span style="color:#24292E;">(</span></span>
<span class="line"><span style="color:#24292E;">        User, </span><span style="color:#E36209;">name</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;UserSimpleSchema&quot;</span><span style="color:#24292E;">, </span><span style="color:#E36209;">include</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;id&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;name&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;image&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;post&quot;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">   )</span></span>
<span class="line"><span style="color:#24292E;">):</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#032F62;">&quot;&quot;&quot;简单展示用户信息，通过include只会序列化这四个字段&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#005CC5;">id</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">int</span></span>
<span class="line"><span style="color:#24292E;">    name: </span><span style="color:#005CC5;">str</span></span>
<span class="line"><span style="color:#24292E;">    image: </span><span style="color:#005CC5;">str</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">None</span></span>
<span class="line"><span style="color:#24292E;">    post: PostSimpleSchema </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">None</span><span style="color:#24292E;">   </span><span style="color:#6A737D;"># 外键岗位字段关系序列化</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">pass</span></span></code></pre></div><h3 id="外键反向查询-多对一-和m2m-多对多" tabindex="-1">外键反向查询（多对一）和m2m（多对多） <a class="header-anchor" href="#外键反向查询-多对一-和m2m-多对多" aria-label="Permalink to &quot;外键反向查询（多对一）和m2m（多对多）&quot;">​</a></h3><ul><li>多对一关系，可以直接根据关联关系名，related_name，来指定,比如下面评论表的帖子信息<code>article: CommentArticleSchema = None</code>;</li><li>多对多可以用List[]来指定,比如下面<code>posters: List[ImageSimpleSchema] = None</code>;</li></ul><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">class</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">CommentArticleSchema</span><span style="color:#E1E4E8;">(</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">pydantic_model_creator</span><span style="color:#E1E4E8;">(ForumArticle,</span></span>
<span class="line"><span style="color:#E1E4E8;">                           </span><span style="color:#FFAB70;">name</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&quot;CommentArticleSchema&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">                           </span><span style="color:#FFAB70;">exclude</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;article_comments&quot;</span><span style="color:#E1E4E8;">, ), </span><span style="color:#FFAB70;">exclude_readonly</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">True</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">):</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">&quot;&quot;&quot;帖子&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">    user: UserSimpleSchema </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> Field(</span><span style="color:#FFAB70;">description</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&quot;发帖人&quot;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">    posters: List[ImageSimpleSchema] </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">None</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">id</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">int</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">pass</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">class</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">CommentBaseSchema</span><span style="color:#E1E4E8;">(</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">pydantic_model_creator</span><span style="color:#E1E4E8;">(ArticleComment,</span></span>
<span class="line"><span style="color:#E1E4E8;">                           </span><span style="color:#FFAB70;">name</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&quot;CommentSimpleSchema&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">                           </span><span style="color:#FFAB70;">exclude</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;write_date&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;upvote_score&quot;</span><span style="color:#E1E4E8;">,))</span></span>
<span class="line"><span style="color:#E1E4E8;">):</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">&quot;&quot;&quot;评论&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">    user: UserSimpleSchema </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> Field(</span><span style="color:#FFAB70;">description</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&quot;评论人&quot;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">    posters: List[ImageSimpleSchema] </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">None</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">class</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">CommentListSchema</span><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">CommentBaseSchema</span><span style="color:#E1E4E8;">):</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">&quot;&quot;&quot;用于帖子列表里面的评论&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">    user: UserSimpleSchema </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> Field(</span><span style="color:#FFAB70;">description</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&quot;评论人&quot;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">    posters: List[ImageSimpleSchema] </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">None</span></span>
<span class="line"><span style="color:#E1E4E8;">    parent_comment: CommentBaseSchema </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">None</span><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;"># 父评论</span></span>
<span class="line"><span style="color:#E1E4E8;">    article: CommentArticleSchema </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">None</span></span>
<span class="line"><span style="color:#E1E4E8;">    anonymous_user: AnonymousUserSimpleSchema </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">None</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">class</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">CommentArticleSchema</span><span style="color:#24292E;">(</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">pydantic_model_creator</span><span style="color:#24292E;">(ForumArticle,</span></span>
<span class="line"><span style="color:#24292E;">                           </span><span style="color:#E36209;">name</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;CommentArticleSchema&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">                           </span><span style="color:#E36209;">exclude</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;article_comments&quot;</span><span style="color:#24292E;">, ), </span><span style="color:#E36209;">exclude_readonly</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">True</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">):</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#032F62;">&quot;&quot;&quot;帖子&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#24292E;">    user: UserSimpleSchema </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> Field(</span><span style="color:#E36209;">description</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;发帖人&quot;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">    posters: List[ImageSimpleSchema] </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">None</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#005CC5;">id</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">int</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">pass</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">class</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">CommentBaseSchema</span><span style="color:#24292E;">(</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">pydantic_model_creator</span><span style="color:#24292E;">(ArticleComment,</span></span>
<span class="line"><span style="color:#24292E;">                           </span><span style="color:#E36209;">name</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;CommentSimpleSchema&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">                           </span><span style="color:#E36209;">exclude</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;write_date&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;upvote_score&quot;</span><span style="color:#24292E;">,))</span></span>
<span class="line"><span style="color:#24292E;">):</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#032F62;">&quot;&quot;&quot;评论&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#24292E;">    user: UserSimpleSchema </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> Field(</span><span style="color:#E36209;">description</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;评论人&quot;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">    posters: List[ImageSimpleSchema] </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">None</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">class</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">CommentListSchema</span><span style="color:#24292E;">(</span><span style="color:#6F42C1;">CommentBaseSchema</span><span style="color:#24292E;">):</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#032F62;">&quot;&quot;&quot;用于帖子列表里面的评论&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#24292E;">    user: UserSimpleSchema </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> Field(</span><span style="color:#E36209;">description</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;评论人&quot;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">    posters: List[ImageSimpleSchema] </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">None</span></span>
<span class="line"><span style="color:#24292E;">    parent_comment: CommentBaseSchema </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">None</span><span style="color:#24292E;">  </span><span style="color:#6A737D;"># 父评论</span></span>
<span class="line"><span style="color:#24292E;">    article: CommentArticleSchema </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">None</span></span>
<span class="line"><span style="color:#24292E;">    anonymous_user: AnonymousUserSimpleSchema </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">None</span></span></code></pre></div><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>Pydantic继承会有一些问题，关联关系会继承失败，所以需要在子类重新声明一下关联关系字段</p></div>`,21),e=[p];function t(c,r,E,y,F,i){return n(),a("div",null,e)}const d=s(o,[["render",t]]);export{q as __pageData,d as default};
